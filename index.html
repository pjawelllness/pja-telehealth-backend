<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PJA Wellness - Telehealth Consultation</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8f9fb;
            min-height: 100vh;
            padding: 20px;
            color: #1a2b3c;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 40px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .header {
            background: white;
            border-bottom: 1px solid #e8edf2;
            padding: 32px 40px;
            text-align: center;
        }
        
        .logo {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #0066cc 0%, #004c99 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .header h1 { 
            font-size: 28px;
            font-weight: 700;
            color: #1a2b3c;
            letter-spacing: -0.5px;
            margin-bottom: 8px;
        }
        
        .header p { 
            color: #5a6c7d;
            font-size: 15px;
            font-weight: 500;
        }
        
        .credentials {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #f0f3f7;
        }
        
        .credential-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #5a6c7d;
            font-weight: 500;
        }
        
        .credential-badge::before {
            content: "‚úì";
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: #e8f5e9;
            color: #2e7d32;
            border-radius: 50%;
            font-weight: 700;
            font-size: 12px;
        }
        
        .content { padding: 40px; }
        
        .step {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        .step.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 40px;
        }
        
        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #e8edf2;
            transition: all 0.3s;
        }
        
        .step-dot.active { 
            background: #0066cc;
            width: 32px;
            border-radius: 5px;
        }
        
        h2 {
            color: #1a2b3c;
            margin-bottom: 8px;
            font-size: 26px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .section-subtitle {
            color: #5a6c7d;
            font-size: 15px;
            margin-bottom: 32px;
            line-height: 1.6;
        }
        
        .service-grid {
            display: grid;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .service-card {
            border: 2px solid #e8edf2;
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            position: relative;
            overflow: hidden;
        }
        
        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #0066cc, #004c99);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .service-card:hover {
            border-color: #0066cc;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 102, 204, 0.12);
        }
        
        .service-card:hover::before {
            opacity: 1;
        }
        
        .service-card.selected {
            border-color: #0066cc;
            background: #f0f7ff;
            box-shadow: 0 4px 16px rgba(0, 102, 204, 0.15);
        }
        
        .service-card.selected::before {
            opacity: 1;
        }
        
        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .service-name {
            font-size: 19px;
            font-weight: 700;
            color: #1a2b3c;
            line-height: 1.3;
        }
        
        .service-duration {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: #f0f3f7;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #5a6c7d;
            white-space: nowrap;
        }
        
        .service-description {
            color: #5a6c7d;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 16px;
        }
        
        .service-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid #e8edf2;
        }
        
        .service-price {
            font-size: 28px;
            font-weight: 700;
            color: #0066cc;
            letter-spacing: -0.5px;
        }
        
        .hsa-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #1a2b3c;
            font-size: 14px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e8edf2;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
            font-family: inherit;
            background: white;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.1);
        }
        
        textarea { 
            min-height: 100px;
            resize: vertical;
            line-height: 1.6;
        }
        
        .time-slot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .time-slot {
            padding: 14px;
            border: 2px solid #e8edf2;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            font-weight: 500;
        }
        
        .time-slot:hover {
            border-color: #0066cc;
            background: #f0f7ff;
        }
        
        .time-slot.selected {
            background: #0066cc;
            color: white;
            border-color: #0066cc;
            font-weight: 600;
        }
        
        .consent-box {
            background: #f8f9fb;
            border: 2px solid #e8edf2;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            max-height: 320px;
            overflow-y: auto;
        }
        
        .consent-box h3 {
            color: #0066cc;
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: 700;
        }
        
        .consent-box p {
            margin-bottom: 14px;
            line-height: 1.7;
            color: #3d4f60;
            font-size: 14px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background: white;
            border-radius: 12px;
            border: 2px solid #e8edf2;
            transition: border-color 0.3s;
        }
        
        .checkbox-group:has(input:checked) {
            border-color: #0066cc;
            background: #f0f7ff;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            justify-content: space-between;
            margin-top: 32px;
        }
        
        button {
            flex: 1;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0066cc 0%, #004c99 100%);
            color: white;
            box-shadow: 0 4px 14px rgba(0, 102, 204, 0.3);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 102, 204, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: #f0f3f7;
            color: #1a2b3c;
        }
        
        .btn-secondary:hover { 
            background: #e8edf2;
        }
        
        .success-message {
            text-align: center;
            padding: 48px 32px;
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            font-size: 40px;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
        }
        
        .success-message h2 {
            color: #1a2b3c;
            margin-bottom: 12px;
        }
        
        .success-message p {
            color: #5a6c7d;
            line-height: 1.7;
            margin-bottom: 12px;
        }
        
        .booking-id {
            background: #f8f9fb;
            padding: 16px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            color: #0066cc;
            font-weight: 600;
            margin: 24px 0;
        }
        
        .loading {
            text-align: center;
            padding: 32px;
            color: #0066cc;
        }
        
        .loading::after {
            content: '';
            display: block;
            width: 40px;
            height: 40px;
            margin: 20px auto 0;
            border: 4px solid #e8edf2;
            border-top-color: #0066cc;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error {
            background: #fef2f2;
            color: #991b1b;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #fee2e2;
        }
        
        .provider-toggle {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: linear-gradient(135deg, #0066cc 0%, #004c99 100%);
            color: white;
            padding: 16px 28px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(0, 102, 204, 0.3);
            z-index: 1000;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .provider-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0, 102, 204, 0.4);
        }
        
        .provider-portal {
            display: none;
        }
        
        .provider-portal.active {
            display: block;
        }
        
        .bookings-grid {
            display: grid;
            gap: 16px;
            margin-top: 24px;
        }
        
        .booking-card {
            border: 2px solid #e8edf2;
            border-radius: 16px;
            padding: 24px;
            background: white;
            transition: all 0.3s;
        }
        
        .booking-card:hover {
            border-color: #0066cc;
            box-shadow: 0 4px 16px rgba(0, 102, 204, 0.08);
        }
        
        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f3f7;
        }
        
        .booking-time {
            font-size: 18px;
            font-weight: 700;
            color: #1a2b3c;
        }
        
        .booking-service {
            font-size: 14px;
            color: #5a6c7d;
            margin-top: 4px;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .patient-info {
            margin-bottom: 12px;
            font-size: 14px;
            color: #3d4f60;
        }
        
        .patient-info strong {
            color: #1a2b3c;
            font-weight: 600;
            margin-right: 8px;
        }
        
        .health-notes {
            background: #f8f9fb;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .health-notes h4 {
            color: #0066cc;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 700;
        }
        
        .health-notes pre {
            white-space: pre-wrap;
            font-family: inherit;
            font-size: 13px;
            line-height: 1.7;
            color: #3d4f60;
        }

        @media (max-width: 768px) {
            body { padding: 12px; }
            .content { padding: 24px; }
            .header { padding: 24px 20px; }
            .header h1 { font-size: 24px; }
            .credentials { flex-direction: column; gap: 12px; align-items: center; }
            .service-header { flex-direction: column; gap: 12px; }
            .time-slot-grid { grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); }
            .provider-toggle { bottom: 16px; right: 16px; padding: 14px 20px; font-size: 14px; }
        }
    </style>
</head>
<body>
    <!-- Patient Booking Portal -->
    <div id="patientPortal" class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üåø</div>
            </div>
            <h1>PJA Wellness Management</h1>
            <p>Secure Telehealth Consultation with Board Certified Practitioners</p>
            <div class="credentials">
                <div class="credential-badge">HIPAA Compliant</div>
                <div class="credential-badge">Board Certified</div>
                <div class="credential-badge">HSA/FSA Accepted</div>
            </div>
        </div>
        
        <div class="content">
            <div class="step-indicator">
                <div class="step-dot active"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
            </div>
            
            <!-- Step 1: Service Selection -->
            <div id="step1" class="step active">
                <h2>Choose Your Service</h2>
                <p class="section-subtitle">Select the consultation type that best fits your needs</p>
                <div class="service-grid">
                    <div class="service-card" onclick="selectService('Comprehensive Wellness Visit')">
                        <div class="service-header">
                            <div class="service-name">Comprehensive Wellness Visit</div>
                            <div class="service-duration">‚è± 45 min</div>
                        </div>
                        <div class="service-description">Complete health assessment and personalized wellness plan with Board Certified Holistic Health Practitioner Patrick Smith</div>
                        <div class="service-footer">
                            <div class="service-price">$99</div>
                            <div class="hsa-badge">‚úì HSA/FSA</div>
                        </div>
                    </div>
                    <div class="service-card" onclick="selectService('Follow-up Consultation')">
                        <div class="service-header">
                            <div class="service-name">Follow-up Consultation</div>
                            <div class="service-duration">‚è± 30 min</div>
                        </div>
                        <div class="service-description">Progress check-in and treatment plan adjustments with your wellness practitioner</div>
                        <div class="service-footer">
                            <div class="service-price">$75</div>
                            <div class="hsa-badge">‚úì HSA/FSA</div>
                        </div>
                    </div>
                    <div class="service-card" onclick="selectService('Acute Care Visit')">
                        <div class="service-header">
                            <div class="service-name">Acute Care Visit</div>
                            <div class="service-duration">‚è± 20 min</div>
                        </div>
                        <div class="service-description">Immediate assessment for urgent concerns and acute symptoms</div>
                        <div class="service-footer">
                            <div class="service-price">$50</div>
                            <div class="hsa-badge">‚úì HSA/FSA</div>
                        </div>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn-primary" onclick="nextStep()" disabled id="step1NextBtn">Continue to Booking</button>
                </div>
            </div>
            
            <!-- Step 2: Personal Info -->
            <div id="step2" class="step">
                <h2>Your Information</h2>
                <p class="section-subtitle">Please provide your contact details for appointment confirmation</p>
                <div class="form-group">
                    <label>First Name *</label>
                    <input type="text" id="firstName" placeholder="Enter your first name" required>
                </div>
                <div class="form-group">
                    <label>Last Name *</label>
                    <input type="text" id="lastName" placeholder="Enter your last name" required>
                </div>
                <div class="form-group">
                    <label>Date of Birth *</label>
                    <input type="date" id="dob" required>
                </div>
                <div class="form-group">
                    <label>Email Address *</label>
                    <input type="email" id="email" placeholder="your.email@example.com" required>
                </div>
                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" id="phone" placeholder="(123) 456-7890" required>
                </div>
                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn-primary" onclick="nextStep()">Continue</button>
                </div>
            </div>
            
            <!-- Step 3: Health Information -->
            <div id="step3" class="step">
                <h2>Health Information</h2>
                <p class="section-subtitle">Help us understand your current health concerns</p>
                <div class="form-group">
                    <label>Primary Concern *</label>
                    <input type="text" id="primaryConcern" placeholder="What brings you in today?" required>
                </div>
                <div class="form-group">
                    <label>Symptoms *</label>
                    <textarea id="symptoms" placeholder="Please describe your symptoms in detail" required></textarea>
                </div>
                <div class="form-group">
                    <label>Duration *</label>
                    <select id="duration" required>
                        <option value="">How long have you experienced this?</option>
                        <option value="Less than 1 week">Less than 1 week</option>
                        <option value="1-2 weeks">1-2 weeks</option>
                        <option value="2-4 weeks">2-4 weeks</option>
                        <option value="1-3 months">1-3 months</option>
                        <option value="More than 3 months">More than 3 months</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Severity (1-10) *</label>
                    <input type="number" id="severity" min="1" max="10" placeholder="Rate from 1 (mild) to 10 (severe)" required>
                </div>
                <div class="form-group">
                    <label>Current Medications</label>
                    <textarea id="medications" placeholder="List any medications you're currently taking"></textarea>
                </div>
                <div class="form-group">
                    <label>Known Allergies</label>
                    <textarea id="allergies" placeholder="List any known allergies"></textarea>
                </div>
                <div class="form-group">
                    <label>Medical History</label>
                    <textarea id="medicalHistory" placeholder="Brief medical history (previous conditions, surgeries, etc.)"></textarea>
                </div>
                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn-primary" onclick="nextStep()">Continue</button>
                </div>
            </div>
            
            <!-- Step 4: Consent Forms -->
            <div id="step4" class="step">
                <h2>Consent & Agreement</h2>
                <p class="section-subtitle">Please review and agree to the following</p>
                
                <div class="consent-box">
                    <h3>HIPAA Privacy Notice</h3>
                    <p><strong>Your Health Information Rights:</strong> You have the right to request restrictions on uses and disclosures of your protected health information, inspect and obtain copies of your health records, and request amendments to your health information.</p>
                    
                    <p><strong>Our Responsibilities:</strong> We are required by law to maintain the privacy of your protected health information and provide you with notice of our legal duties and privacy practices. We will not use or disclose your health information without your written authorization, except as described in this notice.</p>
                    
                    <p><strong>How We Use Your Information:</strong> We may use and disclose your health information for treatment, payment, and healthcare operations. We may also share information with other healthcare providers involved in your care, process insurance claims, and conduct quality improvement activities.</p>
                    
                    <p><strong>Your Privacy:</strong> We maintain physical, electronic, and procedural safeguards to protect your health information. Access to your information is limited to authorized personnel only.</p>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="hipaaConsent">
                    <label for="hipaaConsent">I have read and agree to the HIPAA Privacy Notice</label>
                </div>
                
                <div class="consent-box">
                    <h3>Telehealth Informed Consent</h3>
                    <p><strong>Nature of Telehealth:</strong> Telehealth involves the use of electronic communications to enable healthcare providers at different locations to share patient medical information for diagnosis, therapy, follow-up, and education.</p>
                    
                    <p><strong>Benefits:</strong> Improved access to medical care by enabling you to remain at home while consulting with your healthcare provider. More efficient medical evaluation and management.</p>
                    
                    <p><strong>Risks:</strong> As with any medical procedure, there are potential risks including technical difficulties, information transmission delays, or security protocol failures. In rare cases, lack of access to complete medical records may result in adverse drug interactions or allergic reactions.</p>
                    
                    <p><strong>Security:</strong> We use industry-standard encryption and security protocols to protect your privacy. However, no system can guarantee complete security.</p>
                    
                    <p><strong>Emergency Situations:</strong> In case of emergency, call 911 immediately. Telehealth is not appropriate for emergency situations.</p>
                    
                    <p><strong>Payment:</strong> You are responsible for payment at the time of service. Services may be eligible for HSA/FSA reimbursement.</p>
                    
                    <p><strong>Right to Withdraw:</strong> You may withdraw consent and discontinue telehealth services at any time without affecting your right to future care.</p>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="telehealthConsent">
                    <label for="telehealthConsent">I have read and agree to the Telehealth Informed Consent</label>
                </div>
                
                <div class="form-group">
                    <label>Electronic Signature (Type your full name) *</label>
                    <input type="text" id="signature" placeholder="Your Full Legal Name" required>
                </div>
                
                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn-primary" onclick="nextStep()">Continue</button>
                </div>
            </div>
            
            <!-- Step 5: Select Appointment Time -->
            <div id="step5" class="step">
                <h2>Select Appointment Time</h2>
                <p class="section-subtitle">Choose a time that works best for you</p>
                <div id="loadingSlots" class="loading">
                    <p>Loading available times...</p>
                </div>
                <div id="timeSlots" class="time-slot-grid"></div>
                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn-primary" onclick="nextStep()" disabled id="step5NextBtn">Confirm Booking</button>
                </div>
            </div>
            
            <!-- Step 6: Confirmation -->
            <div id="step6" class="step">
                <div id="bookingResult"></div>
            </div>
        </div>
    </div>
    
    <!-- Provider Portal Toggle -->
    <div class="provider-toggle" onclick="toggleProviderPortal()">
        <span>üë®‚Äç‚öïÔ∏è</span>
        <span>Provider Portal</span>
    </div>
    
    <!-- Provider Portal -->
    <div id="providerPortal" class="provider-portal container">
        <div class="header">
            <h1>üë®‚Äç‚öïÔ∏è Provider Portal</h1>
            <p>Upcoming Telehealth Appointments</p>
        </div>
        
        <div class="content">
            <button class="btn-primary" onclick="toggleProviderPortal()" style="margin-bottom: 24px;">Back to Patient Portal</button>
            <div id="loadingBookings" class="loading">
                <p>Loading appointments...</p>
            </div>
            <div id="bookingsList" class="bookings-grid"></div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let currentStep = 1;
        let bookingData = {
            selectedService: null,
            serviceId: null,
            customerInfo: {},
            healthInfo: {},
            consent: {},
            selectedTime: null
        };
        
        const SERVICE_IDS = {
            'Comprehensive Wellness Visit': 'EOS5TK4VKO6YGM4TYUFMXO2W',
            'Follow-up Consultation': 'KOGODBCXVOKARIL3YZ5DVSKS',
            'Acute Care Visit': '45HRDI4XGITSL4SYOKJKYNK4'
        };
        
        function selectService(serviceName) {
            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            bookingData.selectedService = serviceName;
            bookingData.serviceId = SERVICE_IDS[serviceName];
            document.getElementById('step1NextBtn').disabled = false;
        }
        
        function nextStep() {
            if (!validateStep(currentStep)) return;
            
            if (currentStep === 4) {
                loadAvailability();
            }
            
            if (currentStep === 5) {
                submitBooking();
                return;
            }
            
            currentStep++;
            updateStepDisplay();
        }
        
        function prevStep() {
            currentStep--;
            updateStepDisplay();
        }
        
        function updateStepDisplay() {
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById(`step${currentStep}`).classList.add('active');
            
            document.querySelectorAll('.step-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index < currentStep);
            });
        }
        
        function validateStep(step) {
            if (step === 1) {
                return bookingData.selectedService !== null;
            }
            
            if (step === 2) {
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();
                const dob = document.getElementById('dob').value;
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();
                
                if (!firstName || !lastName || !dob || !email || !phone) {
                    alert('Please fill in all required fields');
                    return false;
                }
                
                bookingData.customerInfo = { firstName, lastName, dob, email, phone };
                return true;
            }
            
            if (step === 3) {
                const primaryConcern = document.getElementById('primaryConcern').value.trim();
                const symptoms = document.getElementById('symptoms').value.trim();
                const duration = document.getElementById('duration').value;
                const severity = document.getElementById('severity').value;
                
                if (!primaryConcern || !symptoms || !duration || !severity) {
                    alert('Please fill in all required fields');
                    return false;
                }
                
                bookingData.healthInfo = {
                    primaryConcern,
                    symptoms,
                    duration,
                    severity,
                    medications: document.getElementById('medications').value.trim(),
                    allergies: document.getElementById('allergies').value.trim(),
                    medicalHistory: document.getElementById('medicalHistory').value.trim()
                };
                return true;
            }
            
            if (step === 4) {
                const hipaa = document.getElementById('hipaaConsent').checked;
                const telehealth = document.getElementById('telehealthConsent').checked;
                const signature = document.getElementById('signature').value.trim();
                
                if (!hipaa || !telehealth || !signature) {
                    alert('Please agree to all consent forms and provide your signature');
                    return false;
                }
                
                bookingData.consent = { hipaa, telehealth, signature };
                return true;
            }
            
            if (step === 5) {
                return bookingData.selectedTime !== null;
            }
            
            return true;
        }
        
        async function loadAvailability() {
            const loadingEl = document.getElementById('loadingSlots');
            const slotsEl = document.getElementById('timeSlots');
            
            loadingEl.style.display = 'block';
            slotsEl.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/api/availability`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ serviceId: bookingData.serviceId })
                });
                
                const data = await response.json();
                loadingEl.style.display = 'none';
                
                if (data.availabilities && data.availabilities.length > 0) {
                    data.availabilities.forEach(slot => {
                        const slotEl = document.createElement('div');
                        slotEl.className = 'time-slot';
                        
                        const date = new Date(slot.startAt);
                        slotEl.innerHTML = `
                            <div><strong>${date.toLocaleDateString()}</strong></div>
                            <div>${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                        `;
                        
                        slotEl.onclick = () => selectTimeSlot(slot.startAt, slotEl);
                        slotsEl.appendChild(slotEl);
                    });
                } else {
                    slotsEl.innerHTML = '<div class="error">No available slots found. Please contact the office.</div>';
                }
            } catch (error) {
                loadingEl.style.display = 'none';
                slotsEl.innerHTML = `<div class="error">Failed to load availability: ${error.message}</div>`;
            }
        }
        
        function selectTimeSlot(time, element) {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            element.classList.add('selected');
            bookingData.selectedTime = time;
            document.getElementById('step5NextBtn').disabled = false;
        }
        
        async function submitBooking() {
            const resultEl = document.getElementById('bookingResult');
            resultEl.innerHTML = '<div class="loading"><p>Creating your appointment...</p></div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/booking`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(bookingData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultEl.innerHTML = `
                        <div class="success-message">
                            <div class="success-icon">‚úì</div>
                            <h2>Appointment Confirmed!</h2>
                            <p>Your telehealth appointment has been successfully scheduled.</p>
                            <div class="booking-id">Booking ID: ${result.bookingId}</div>
                            <p>You will receive a confirmation email with your appointment details and secure video link.</p>
                            <button class="btn-primary" onclick="location.reload()" style="margin-top: 24px;">Book Another Appointment</button>
                        </div>
                    `;
                } else {
                    resultEl.innerHTML = `
                        <div class="error">
                            <h3>Booking Failed</h3>
                            <p>${result.error || 'An error occurred'}</p>
                            <button class="btn-primary" onclick="prevStep()">Go Back</button>
                        </div>
                    `;
                }
            } catch (error) {
                resultEl.innerHTML = `
                    <div class="error">
                        <h3>Booking Failed</h3>
                        <p>Please call our office: (586) 557-2224</p>
                        <button class="btn-primary" onclick="prevStep()">Go Back</button>
                    </div>
                `;
            }
        }
        
        async function toggleProviderPortal() {
            const patientPortal = document.getElementById('patientPortal');
            const providerPortal = document.getElementById('providerPortal');
            
            if (providerPortal.classList.contains('active')) {
                providerPortal.classList.remove('active');
                patientPortal.style.display = 'block';
            } else {
                providerPortal.classList.add('active');
                patientPortal.style.display = 'none';
                loadBookings();
            }
        }
        
        async function loadBookings() {
            const loadingEl = document.getElementById('loadingBookings');
            const bookingsEl = document.getElementById('bookingsList');
            
            loadingEl.style.display = 'block';
            bookingsEl.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/api/bookings`);
                const data = await response.json();
                
                loadingEl.style.display = 'none';
                
                if (data.bookings && data.bookings.length > 0) {
                    data.bookings.forEach(booking => {
                        const bookingCard = createBookingCard(booking);
                        bookingsEl.appendChild(bookingCard);
                    });
                } else {
                    bookingsEl.innerHTML = '<p>No upcoming appointments</p>';
                }
            } catch (error) {
                loadingEl.style.display = 'none';
                bookingsEl.innerHTML = `<div class="error">Failed to load bookings: ${error.message}</div>`;
            }
        }
        
        function createBookingCard(booking) {
            const card = document.createElement('div');
            card.className = 'booking-card';
            
            const startTime = new Date(booking.startAt);
            const customer = booking.customerDetails;
            
            card.innerHTML = `
                <div class="booking-header">
                    <div>
                        <div class="booking-time">${startTime.toLocaleString()}</div>
                        <div class="booking-service">${booking.appointmentSegments?.[0]?.serviceVariationId || 'Telehealth Visit'}</div>
                    </div>
                    <div class="status-badge">Confirmed</div>
                </div>
                
                ${customer ? `
                    <div class="patient-info">
                        <strong>Patient:</strong> ${customer.givenName} ${customer.familyName}
                    </div>
                    <div class="patient-info">
                        <strong>Email:</strong> ${customer.emailAddress || 'N/A'}
                    </div>
                    <div class="patient-info">
                        <strong>Phone:</strong> ${customer.phoneNumber || 'N/A'}
                    </div>
                    
                    ${customer.note ? `
                        <div class="health-notes">
                            <h4>Health Information & Consent</h4>
                            <pre>${customer.note}</pre>
                        </div>
                    ` : ''}
                ` : '<div class="patient-info">Patient information not available</div>'}
            `;
            
            return card;
        }
    </script>
</body>
</html>
