<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PJA Wellness - Telehealth Booking</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8f9fb;
            min-height: 100vh;
            padding: 20px;
            color: #1a1a1a;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            padding: 48px 40px;
            text-align: center;
            position: relative;
        }
        
        .header h1 { 
            font-size: 32px; 
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .header p { 
            opacity: 0.95; 
            font-size: 16px;
            font-weight: 400;
        }
        
        .trust-badges {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 24px;
            flex-wrap: wrap;
        }
        
        .trust-badge {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .content { padding: 48px 40px; }
        
        .step {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        .step.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 40px;
        }
        
        .step-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: all 0.3s;
        }
        
        .step-dot.active { 
            background: #2563eb;
            width: 24px;
            border-radius: 4px;
        }
        
        h2 {
            color: #111827;
            margin-bottom: 32px;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .service-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .service-card {
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 28px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            position: relative;
        }
        
        .service-card:hover {
            border-color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(37, 99, 235, 0.12);
        }
        
        .service-card.selected {
            border-color: #2563eb;
            background: #eff6ff;
            box-shadow: 0 8px 24px rgba(37, 99, 235, 0.12);
        }
        
        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .service-name {
            font-size: 20px;
            font-weight: 600;
            color: #111827;
            letter-spacing: -0.3px;
        }
        
        .service-price {
            font-size: 24px;
            font-weight: 700;
            color: #2563eb;
        }
        
        .service-details {
            color: #6b7280;
            font-size: 15px;
            margin-bottom: 8px;
            line-height: 1.6;
        }
        
        .hsa-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: #10b981;
            color: white;
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
            margin-top: 12px;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #374151;
            font-size: 15px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
            color: #111827;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        textarea { min-height: 100px; resize: vertical; }
        
        .time-slot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 32px;
        }
        
        .time-slot {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            color: #374151;
        }
        
        .time-slot:hover {
            border-color: #2563eb;
            background: #eff6ff;
        }
        
        .time-slot.selected {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        
        .consent-box {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            max-height: 320px;
            overflow-y: auto;
        }
        
        .consent-box h3 {
            color: #2563eb;
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .consent-box p {
            margin-bottom: 14px;
            line-height: 1.7;
            color: #4b5563;
            font-size: 14px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background: white;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            margin: 0;
            font-weight: 500;
            cursor: pointer;
        }
        
        .button-group {
            display: flex;
            gap: 16px;
            justify-content: space-between;
            margin-top: 40px;
        }
        
        button {
            flex: 1;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }
        
        .btn-primary {
            background: #2563eb;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #1e40af;
            transform: translateY(-1px);
            box-shadow: 0 8px 16px rgba(37, 99, 235, 0.2);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }
        
        .btn-secondary:hover { 
            background: #e5e7eb; 
        }
        
        .success-message {
            text-align: center;
            padding: 48px 24px;
        }
        
        .success-icon {
            font-size: 64px;
            margin-bottom: 24px;
        }
        
        .loading {
            text-align: center;
            padding: 32px;
            color: #2563eb;
        }
        
        .error {
            background: #fef2f2;
            color: #991b1b;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #fecaca;
        }
        
        /* Provider Portal Styles */
        .provider-access {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
        }
        
        .provider-btn {
            background: white;
            color: #2563eb;
            padding: 14px 24px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            border: 2px solid #2563eb;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.2s;
        }
        
        .provider-btn:hover {
            background: #2563eb;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.25);
        }
        
        .provider-portal {
            display: none;
        }
        
        .provider-portal.active {
            display: block;
        }
        
        .bookings-grid {
            display: grid;
            gap: 20px;
            margin-top: 24px;
        }
        
        .booking-card {
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 24px;
            background: #f9fafb;
        }
        
        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .booking-time {
            font-size: 18px;
            font-weight: 600;
            color: #2563eb;
        }
        
        .booking-service {
            font-size: 14px;
            color: #6b7280;
            margin-top: 4px;
        }
        
        .status-badge {
            background: #10b981;
            color: white;
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .patient-info {
            margin-bottom: 12px;
            color: #4b5563;
            font-size: 15px;
        }
        
        .patient-info strong {
            color: #111827;
            margin-right: 6px;
        }
        
        .health-notes {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid #e5e7eb;
        }
        
        .health-notes h4 {
            color: #2563eb;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Patient Booking Portal -->
    <div id="patientPortal" class="container">
        <div class="header">
            <h1>PJA Wellness Management</h1>
            <p>Board Certified Holistic Health Practitioner | HIPAA-Compliant Telehealth</p>
            <div class="trust-badges">
                <div class="trust-badge">🔒 HIPAA Secure</div>
                <div class="trust-badge">✓ Board Certified</div>
                <div class="trust-badge">💳 HSA/FSA Accepted</div>
            </div>
        </div>
        
        <div class="content">
            <div class="step-indicator">
                <div class="step-dot active"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
                <div class="step-dot"></div>
            </div>
            
            <!-- Step 1: Service Selection -->
            <div id="step1" class="step active">
                <h2>Select Your Service</h2>
                <div class="service-grid">
                    <div class="service-card" onclick="selectService('Comprehensive Wellness Visit')">
                        <div class="service-header">
                            <div class="service-name">Comprehensive Wellness Visit</div>
                            <div class="service-price">$99</div>
                        </div>
                        <div class="service-details">⏱ 45 minutes with Board Certified Practitioner</div>
                        <div class="service-details">Complete health assessment and personalized wellness plan</div>
                        <div class="hsa-badge">✓ HSA/FSA Accepted</div>
                    </div>
                    <div class="service-card" onclick="selectService('Follow-up Consultation')">
                        <div class="service-header">
                            <div class="service-name">Follow-up Consultation</div>
                            <div class="service-price">$75</div>
                        </div>
                        <div class="service-details">⏱ 30 minutes with Board Certified Practitioner</div>
                        <div class="service-details">Progress check-in and treatment plan adjustments</div>
                        <div class="hsa-badge">✓ HSA/FSA Accepted</div>
                    </div>
                    <div class="service-card" onclick="selectService('Acute Care Visit')">
                        <div class="service-header">
                            <div class="service-name">Acute Care Visit</div>
                            <div class="service-price">$50</div>
                        </div>
                        <div class="service-details">⏱ 20 minutes with Board Certified Practitioner</div>
                        <div class="service-details">Immediate concerns and acute symptoms</div>
                        <div class="hsa-badge">✓ HSA/FSA Accepted</div>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn-primary" onclick="nextStep()" disabled id="step1NextBtn">Continue to Personal Info</button>
                </div>
            </div>
            
            <!-- Step 2: Personal Info -->
            <div id="step2" class="step">
                <h2>Your Information</h2>
                <div class="form-group">
                    <label>First Name *</label>
                    <input type="text" id="firstName" required>
                </div>
                <div class="form-group">
                    <label>Last Name *</label>
                    <input type="text" id="lastName" required>
                </div>
                <div class="form-group">
                    <label>Date of Birth *</label>
                    <input type="date" id="dob" required>
                </div>
                <div class="form-group">
                    <label>Email Address *</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" id="phone" required placeholder="(123) 456-7890">
                </div>
                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn-primary" onclick="nextStep()">Continue to Health Info</button>
                </div>
            </div>
            
            <!-- Step 3: Health Information -->
            <div id="step3" class="step">
                <h2>Health Information</h2>
                <div class="form-group">
                    <label>Primary Concern *</label>
                    <input type="text" id="primaryConcern" required placeholder="e.g., digestive issues, fatigue, stress management">
                </div>
                <div class="form-group">
                    <label>Current Symptoms *</label>
                    <textarea id="symptoms" required placeholder="Please describe your symptoms in detail"></textarea>
                </div>
                <div class="form-group">
                    <label>How Long Have You Experienced These Symptoms? *</label>
                    <select id="duration" required>
                        <option value="">Select duration...</option>
                        <option value="Less than 1 week">Less than 1 week</option>
                        <option value="1-2 weeks">1-2 weeks</option>
                        <option value="2-4 weeks">2-4 weeks</option>
                        <option value="1-3 months">1-3 months</option>
                        <option value="More than 3 months">More than 3 months</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Symptom Severity (1-10) *</label>
                    <input type="number" id="severity" min="1" max="10" required placeholder="1 = Mild, 10 = Severe">
                </div>
                <div class="form-group">
                    <label>Current Medications</label>
                    <textarea id="medications" placeholder="List all current medications, supplements, and vitamins"></textarea>
                </div>
                <div class="form-group">
                    <label>Known Allergies</label>
                    <textarea id="allergies" placeholder="Food allergies, medication allergies, environmental allergies"></textarea>
                </div>
                <div class="form-group">
                    <label>Relevant Medical History</label>
                    <textarea id="medicalHistory" placeholder="Previous diagnoses, surgeries, chronic conditions"></textarea>
                </div>
                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn-primary" onclick="nextStep()">Continue to Consent</button>
                </div>
            </div>
            
            <!-- Step 4: Consent Forms -->
            <div id="step4" class="step">
                <h2>Consent Forms</h2>
                
                <div class="consent-box">
                    <h3>HIPAA Privacy Notice</h3>
                    <p><strong>Your Health Information Rights:</strong> You have the right to request restrictions on uses and disclosures of your protected health information, inspect and obtain copies of your health records, and request amendments to your health information.</p>
                    
                    <p><strong>Our Responsibilities:</strong> We are required by law to maintain the privacy of your protected health information and provide you with notice of our legal duties and privacy practices. We will not use or disclose your health information without your written authorization, except as described in this notice.</p>
                    
                    <p><strong>How We Use Your Information:</strong> We may use and disclose your health information for treatment, payment, and healthcare operations. We may also share information with other healthcare providers involved in your care, process insurance claims, and conduct quality improvement activities.</p>
                    
                    <p><strong>Your Privacy:</strong> We maintain physical, electronic, and procedural safeguards to protect your health information. Access to your information is limited to authorized personnel only.</p>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="hipaaConsent">
                    <label for="hipaaConsent">I have read and agree to the HIPAA Privacy Notice</label>
                </div>
                
                <div class="consent-box">
                    <h3>Telehealth Informed Consent</h3>
                    <p><strong>Nature of Telehealth:</strong> Telehealth involves the use of electronic communications to enable healthcare providers at different locations to share patient medical information for diagnosis, therapy, follow-up, and education.</p>
                    
                    <p><strong>Benefits:</strong> Improved access to medical care by enabling you to remain at home while consulting with your healthcare provider. More efficient medical evaluation and management.</p>
                    
                    <p><strong>Risks:</strong> As with any medical procedure, there are potential risks including technical difficulties, information transmission delays, or security protocol failures. In rare cases, lack of access to complete medical records may result in adverse drug interactions or allergic reactions.</p>
                    
                    <p><strong>Security:</strong> We use industry-standard encryption and security protocols to protect your privacy. However, no system can guarantee complete security.</p>
                    
                    <p><strong>Emergency Situations:</strong> In case of emergency, call 911 immediately. Telehealth is not appropriate for emergency situations.</p>
                    
                    <p><strong>Payment:</strong> You are responsible for payment at the time of service. Services may be eligible for HSA/FSA reimbursement.</p>
                    
                    <p><strong>Right to Withdraw:</strong> You may withdraw consent and discontinue telehealth services at any time without affecting your right to future care.</p>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="telehealthConsent">
                    <label for="telehealthConsent">I have read and agree to the Telehealth Informed Consent</label>
                </div>
                
                <div class="form-group">
                    <label>Electronic Signature (Type your full name) *</label>
                    <input type="text" id="signature" required placeholder="John Doe">
                </div>
                
                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn-primary" onclick="nextStep()">Continue to Scheduling</button>
                </div>
            </div>
            
            <!-- Step 5: Select Appointment Time -->
            <div id="step5" class="step">
                <h2>Select Appointment Time</h2>
                <div id="loadingSlots" class="loading">
                    <p>Loading available times...</p>
                </div>
                <div id="timeSlots" class="time-slot-grid"></div>
                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn-primary" onclick="nextStep()" disabled id="step5NextBtn">Complete Booking</button>
                </div>
            </div>
            
            <!-- Step 6: Confirmation -->
            <div id="step6" class="step">
                <div id="bookingResult"></div>
            </div>
        </div>
    </div>
    
    <!-- Provider Portal Access -->
    <div class="provider-access">
        <button class="provider-btn" onclick="toggleProviderPortal()">
            👨‍⚕️ Provider Portal
        </button>
    </div>
    
    <!-- Provider Portal -->
    <div id="providerPortal" class="provider-portal container">
        <div class="header">
            <h1>Provider Portal</h1>
            <p>Upcoming Telehealth Appointments</p>
        </div>
        
        <div class="content">
            <button class="btn-secondary" onclick="toggleProviderPortal()" style="margin-bottom: 24px;">← Back to Patient Portal</button>
            <div id="loadingBookings" class="loading">
                <p>Loading appointments...</p>
            </div>
            <div id="bookingsList" class="bookings-grid"></div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let currentStep = 1;
        let bookingData = {
            selectedService: null,
            serviceId: null,
            customerInfo: {},
            healthInfo: {},
            consent: {},
            selectedTime: null
        };
        
        const SERVICE_IDS = {
            'Comprehensive Wellness Visit': 'EOS5TK4VKO6YGM4TYUFMXO2W',
            'Follow-up Consultation': 'KOGODBCXVOKARIL3YZ5DVSKS',
            'Acute Care Visit': '45HRDI4XGITSL4SYOKJKYNK4'
        };
        
        function selectService(serviceName) {
            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            bookingData.selectedService = serviceName;
            bookingData.serviceId = SERVICE_IDS[serviceName];
            document.getElementById('step1NextBtn').disabled = false;
        }
        
        function nextStep() {
            if (!validateStep(currentStep)) return;
            
            if (currentStep === 4) {
                loadAvailability();
            }
            
            if (currentStep === 5) {
                submitBooking();
                return;
            }
            
            currentStep++;
            updateStepDisplay();
        }
        
        function prevStep() {
            currentStep--;
            updateStepDisplay();
        }
        
        function updateStepDisplay() {
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById(`step${currentStep}`).classList.add('active');
            
            document.querySelectorAll('.step-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index < currentStep);
            });
        }
        
        function validateStep(step) {
            if (step === 1) {
                return bookingData.selectedService !== null;
            }
            
            if (step === 2) {
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();
                const dob = document.getElementById('dob').value;
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();
                
                if (!firstName || !lastName || !dob || !email || !phone) {
                    alert('Please fill in all required fields');
                    return false;
                }
                
                bookingData.customerInfo = { firstName, lastName, dob, email, phone };
                return true;
            }
            
            if (step === 3) {
                const primaryConcern = document.getElementById('primaryConcern').value.trim();
                const symptoms = document.getElementById('symptoms').value.trim();
                const duration = document.getElementById('duration').value;
                const severity = document.getElementById('severity').value;
                
                if (!primaryConcern || !symptoms || !duration || !severity) {
                    alert('Please fill in all required fields');
                    return false;
                }
                
                bookingData.healthInfo = {
                    primaryConcern,
                    symptoms,
                    duration,
                    severity,
                    medications: document.getElementById('medications').value.trim(),
                    allergies: document.getElementById('allergies').value.trim(),
                    medicalHistory: document.getElementById('medicalHistory').value.trim()
                };
                return true;
            }
            
            if (step === 4) {
                const hipaa = document.getElementById('hipaaConsent').checked;
                const telehealth = document.getElementById('telehealthConsent').checked;
                const signature = document.getElementById('signature').value.trim();
                
                if (!hipaa || !telehealth || !signature) {
                    alert('Please agree to all consent forms and provide your signature');
                    return false;
                }
                
                bookingData.consent = { hipaa, telehealth, signature };
                return true;
            }
            
            if (step === 5) {
                return bookingData.selectedTime !== null;
            }
            
            return true;
        }
        
        async function loadAvailability() {
            const loadingEl = document.getElementById('loadingSlots');
            const slotsEl = document.getElementById('timeSlots');
            
            loadingEl.style.display = 'block';
            slotsEl.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/api/availability`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ serviceId: bookingData.serviceId })
                });
                
                const data = await response.json();
                loadingEl.style.display = 'none';
                
                if (data.availabilities && data.availabilities.length > 0) {
                    data.availabilities.forEach(slot => {
                        const slotEl = document.createElement('div');
                        slotEl.className = 'time-slot';
                        
                        const date = new Date(slot.startAt);
                        slotEl.innerHTML = `
                            <div><strong>${date.toLocaleDateString()}</strong></div>
                            <div>${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                        `;
                        
                        slotEl.onclick = () => selectTimeSlot(slot.startAt, slotEl);
                        slotsEl.appendChild(slotEl);
                    });
                } else {
                    slotsEl.innerHTML = '<div class="error">No available slots found. Please contact the office.</div>';
                }
            } catch (error) {
                loadingEl.style.display = 'none';
                slotsEl.innerHTML = `<div class="error">Failed to load availability: ${error.message}</div>`;
            }
        }
        
        function selectTimeSlot(time, element) {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            element.classList.add('selected');
            bookingData.selectedTime = time;
            document.getElementById('step5NextBtn').disabled = false;
        }
        
        async function submitBooking() {
            const resultEl = document.getElementById('bookingResult');
            resultEl.innerHTML = '<div class="loading"><p>Creating your appointment...</p></div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/booking`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(bookingData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultEl.innerHTML = `
                        <div class="success-message">
                            <div class="success-icon">✅</div>
                            <h2>Appointment Confirmed!</h2>
                            <p>Your telehealth appointment has been successfully booked.</p>
                            <p style="color: #6b7280; margin-top: 16px;"><strong>Booking ID:</strong> ${result.bookingId}</p>
                            <p style="color: #6b7280;">You will receive a confirmation email with your appointment details and video link.</p>
                            <button class="btn-primary" onclick="location.reload()" style="margin-top: 32px;">Book Another Appointment</button>
                        </div>
                    `;
                } else {
                    resultEl.innerHTML = `
                        <div class="error">
                            <h3>Booking Failed</h3>
                            <p>${result.error || 'An error occurred'}</p>
                            <button class="btn-primary" onclick="prevStep()" style="margin-top: 16px;">Go Back</button>
                        </div>
                    `;
                }
            } catch (error) {
                resultEl.innerHTML = `
                    <div class="error">
                        <h3>Booking Failed</h3>
                        <p>Please call our office: (586) 557-2224</p>
                        <button class="btn-primary" onclick="prevStep()" style="margin-top: 16px;">Go Back</button>
                    </div>
                `;
            }
        }
        
        // Provider Portal Functions
        async function toggleProviderPortal() {
            const patientPortal = document.getElementById('patientPortal');
            const providerPortal = document.getElementById('providerPortal');
            
            if (providerPortal.classList.contains('active')) {
                providerPortal.classList.remove('active');
                patientPortal.style.display = 'block';
            } else {
                providerPortal.classList.add('active');
                patientPortal.style.display = 'none';
                loadBookings();
            }
        }
        
        async function loadBookings() {
            const loadingEl = document.getElementById('loadingBookings');
            const bookingsEl = document.getElementById('bookingsList');
            
            loadingEl.style.display = 'block';
            bookingsEl.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/api/bookings`);
                const data = await response.json();
                
                loadingEl.style.display = 'none';
                
                if (data.bookings && data.bookings.length > 0) {
                    data.bookings.forEach(booking => {
                        const bookingCard = createBookingCard(booking);
                        bookingsEl.appendChild(bookingCard);
                    });
                } else {
                    bookingsEl.innerHTML = '<p style="text-align: center; color: #6b7280;">No upcoming appointments</p>';
                }
            } catch (error) {
                loadingEl.style.display = 'none';
                bookingsEl.innerHTML = `<div class="error">Failed to load bookings: ${error.message}</div>`;
            }
        }
        
        function createBookingCard(booking) {
            const card = document.createElement('div');
            card.className = 'booking-card';
            
            const startTime = new Date(booking.startAt);
            const customer = booking.customerDetails;
            
            card.innerHTML = `
                <div class="booking-header">
                    <div>
                        <div class="booking-time">${startTime.toLocaleString()}</div>
                        <div class="booking-service">${booking.appointmentSegments?.[0]?.serviceVariationId || 'Telehealth Visit'}</div>
                    </div>
                    <div class="status-badge">Confirmed</div>
                </div>
                
                ${customer ? `
                    <div class="patient-info">
                        <strong>Patient:</strong> ${customer.givenName} ${customer.familyName}
                    </div>
                    <div class="patient-info">
                        <strong>Email:</strong> ${customer.emailAddress || 'N/A'}
                    </div>
                    <div class="patient-info">
                        <strong>Phone:</strong> ${customer.phoneNumber || 'N/A'}
                    </div>
                    
                    ${customer.note ? `
                        <div class="health-notes">
                            <h4>Health Information & Consent</h4>
                            <pre style="white-space: pre-wrap; font-family: 'Inter', sans-serif; font-size: 14px; color: #4b5563; line-height: 1.6;">${customer.note}</pre>
                        </div>
                    ` : ''}
                ` : '<div class="patient-info">Patient information not available</div>'}
            `;
            
            return card;
        }
    </script>
</body>
</html>
